---
title: "Convert an existing Gatsby Markdown blog to use MDX"
date: "2020-08-04"
description: ""
---

I've recently released a new version of my personal website and I decided to convert my posts from an existing Gatsby Markdown format to MDX.

MDX is usually called _the markdown for the component era_ and it's a great way to write a document using JSX in Markdown. Additionally, if you work on a React project, you can even import existing components inside your MDX files.

Let's get started!

### Step 1

In order to use MDX with Gatsby, you need to install `@mdx-js/mdx{:js}`, `@mdx-js/react{:js}` and the official Gatsby plugin `gatsby-plugin-mdx{:js}`:

```bash title="Terminal"
npm install --save @mdx-js/mdx @mdx-js/react gatsby-plugin-mdx
```

### Step 2

Inside your `gatsby-config.js{:js}` file, replace `gatsby-transformer-remark{:js}` with `gatsby-plugin-mdx{:js}`:

```diff title="gatsby-config.js"
- resolve: `gatsby-transformer-remark`,
+ resolve: `gatsby-plugin-mdx`,
```

and `plugins{:js}` with `gatsbyRemarkPlugins{:js}`:

```diff title="gatsby-config.js"
- plugins: [
+ gatsbyRemarkPlugins: [
```

My configured `gatsby-plugin-mdx{:js}` looks like this:

```js title="gatsby-config.js"
{
  // parses Markdown files using MDX
  resolve: `gatsby-plugin-mdx`,
  options: {
    gatsbyRemarkPlugins: [
      {
        // parses Markdown images using Remark
        resolve: `gatsby-remark-images`,
        options: {
          maxWidth: 1200,
        },
      },
    ],
  },
},
```

### Step 3

Once we've refactored the `gatsby-config.js{:js}` file, it's time to work with `gatsby-node.js{:js}`.
Here, we need to replace `allMarkdownRemark{:js}` with `allMdx{:js}`:

```diff title="gatsby-node.js"
- allMarkdownRemark {
+ allMdx {
```

```diff title="gatsby-node.js"
- results.data.allMarkdownRemark.edges.forEach(({node}) => {
+ results.data.allMdx.edges.forEach(({node}) => {
```

### Step 4

The final step consists in refactoring the template file that is used to generate the blog posts.
Head over to the template, in my case `src/templates/postTemplate.js{:js}`, and import `MDXRenderer{:js}` from the `gatsby-plugin-mdx{:js}` plugin that we installed earlier:

```diff title="src/templates/postTemplate.js"
+ import { MDXRenderer } from 'gatsby-plugin-mdx'
```

Then, replace `markdownRemark{:js}` with `mdx{:js}` in the `render(){:js}` method:

```diff title="src/templates/postTemplate.js"
- const { markdownRemark } = this.props.data
+ const { mdx } = this.props.data
```

Finally, refactor the GraphQL query by using `mdx{:js}` instead of `markdownRemark{:js}` and `body{:js}` instead of `html{:js}`:

```diff title="src/templates/postTemplate.js"
- markdownRemark(frontmatter: {
+ mdx(frontmatter: {
```

```diff title="src/templates/postTemplate.js"
- html
+ body
```

The refactored post query will look like this:

```jsx title="src/templates/postTemplate.js"
export const query = graphql`
  query PostQuery($slug: String!) {
    mdx(frontmatter: { slug: { eq: $slug } }) {
      body
      frontmatter {
        title
        date(formatString: "MMMM DD, YYYY")
        slug
        tags
      }
    }
  }
`;
```

and the template component:

```jsx title="src/templates/postTemplate.js"
import React from "react";
import { graphql } from "gatsby";
import { MDXRenderer } from "gatsby-plugin-mdx";

import Layout from "../components/layout";
import SEO from "../components/seo";

const PostTemplate = ({
  data: {
    mdx: {
      frontmatter: { title },
      body,
    },
  },
}) => (
  <Layout>
    <SEO title={title} />
    <h1>{title}</h1>
    <MDXRenderer>{body}</MDXRenderer>
  </Layout>
);

export default PostTemplate;
```

This is it! From now on, anytime you want to create a blog post, remember to use the `.mdx{:mdx}` extension.
